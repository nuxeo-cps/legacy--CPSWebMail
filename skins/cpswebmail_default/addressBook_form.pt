<tal:block define="global hideactions python:1" />

<tal:block define="wmtool here/portal_webMail;
                   mcat nocall:here/Localizer/default;
                   dirtool here/portal_directories;
                   lists_name wmtool/getMailingListName;
                   privbook_name wmtool/getPrivAddressBookName;
                   privbooklinks_name wmtool/getPrivAddressBookLinksName;
                   addressbook_name request/addressbook_name|string:_private;
                   addressbook python:wmtool.getCurrentAddressBook(REQUEST=request);
            ">
<html metal:use-macro="here/main_template/macros/master">

<metal:block fill-slot="javascript_head_slot">
  <script type="text/javascript"
    tal:attributes="src string:${base_url}cpswebmail_functions.js"></script>
</metal:block>

<metal:block fill-slot="header">
  <h1 tal:define="addressbook_title python:wmtool.getCurrentAddressBook(addressbook_name).title_or_id();"
      tal:content="python:mcat(addressbook_title)">Address book title</h1>
  <metal:block use-macro="here/webmail_lib/macros/back_to_message_list"/>
</metal:block>

<metal:block fill-slot="header_plus" />

<metal:block fill-slot="main" tal:define="portal_url base_url;">
  <form name="addressbook_form"
        tal:attributes="action string:${here/absolute_url};
                        method string:post;">

   <table border="0" cellPadding="2" cellscpacing="0" width="100%">
     <tr>
      <td align="left" valign="middle">
        <input size="20" name="search_param" value="" />
        <input name="from_addressbook_search:method"
          tal:attributes="
            type  string:submit;
            value python:mcat('_Search_');
          " />
      </td>
      <td align="right" valign="middle">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr>
            <td align="center" valign="middle">
              <b tal:content="python:mcat('_Change_list_to_')">
                Change list to:
              </b>
            </td>
          </tr>
          <tr>
            <td align="left" valign="middle">
              <select size="1" name="addressbook_name">
                <tal:block condition="python:privbook_name">
                  <tal:block define="
                    privbook python:wmtool.getCurrentAddressBook('_private');
                    privbook_prop_name wmtool/getPrivAddressBookEmailProperty;">
                    <option value="_private"
                      tal:attributes="selected python:addressbook_name == '_private';"
                      tal:content="python:mcat(privbook.title_or_id())">
                    </option>
                  </tal:block>
                </tal:block>
                <tal:block condition="python:privbooklinks_name">
                  <tal:block define="
                    privbooklinks python:wmtool.getCurrentAddressBook('_private_links');
                    privbooklinks_prop_name wmtool/getPrivAddressBookLinksEmailProperty;">
                    <option value="_private_links"
                      tal:attributes="selected python:addressbook_name == '_private_links';"
                      tal:content="python:mcat(privbooklinks.title_or_id())">
                    </option>
                  </tal:block>
                </tal:block>
                <option value="_global"
                  tal:content="python:mcat('_Address_book_')"
                  tal:attributes="selected python:addressbook_name == '_global';">
                  Addresses
                </option>
                <tal:block condition="python:lists_name">
                  <tal:block define="
                    lists_prop_name wmtool/getMailingListsEmailProperty;
                    lists python:dirtool[lists_name];
                    id_field lists/id_field;
                    title_field lists/title_field">
                    <tal:block define="items
                      python:lists.searchEntries(return_fields=[id_field,title_field])">
                      <tal:block repeat="item items">
                        <option
                          tal:attributes="value python:item[0];
                                          selected python:addressbook_name == item[0];"
                          tal:content="python:item[1][id_field]">
                        </option>
                      </tal:block>
                      <tal:block condition="not:items">
                        <option value="_mailing"
                          tal:attributes="selected python:addressbook_name == '_mailing';"
                          tal:content="python:mcat('_Mailing_Lists_')">
                        </option>
                      </tal:block>
                    </tal:block>
                  </tal:block>
                </tal:block>
              </select>
              <input type="submit"
                     name="addressbook_changelist:method"
                     value="Ok" />
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr tal:condition="nothing|string:This part is commented out">
      <td colspan="2" align="left">
        <ul type="square">
          <li>
            <a target="_blank"
               tal:define="abookid python:wmtool.getCurrentAddressBookName(REQUEST=request);"
               tal:attributes="
                 href string:${portal_url}cpsdirectory_entry_search_form?dirname=${abookid};"
               tal:content="python:mcat('_searchbox_Advanced_search')">
            </a>
          </li>
        </ul>
      </td>
    </tr>
    <tr tal:condition="nothing|string:This part is commented out">
      <td colspan="2" align="left">
        <ul type="square">
          <li>
            <a
              tal:attributes="
                href string:${here/absolute_url}/addressbook_import_form"
              tal:content="python:mcat('_Import_from_MSOutlook_address_book_')">
              Import from MSOutlook address book
            </a>
          </li>
        </ul>
      </td>
    </tr>
  </table>
  <table width="100%" cellpadding="2" cellspacing="0" border="0">
    <tr bgcolor="#dcdcdc">
      <td nowrap>
        <input type="button"
          tal:condition="python:addressbook.isCreateEntryAllowed()"
          tal:attributes="value python:mcat('_New_contact_');
                          onclick string:javascript:popup_create_entry('addressbook_addcontact', '${addressbook_name}');;"/>
        <input type="submit"
          name="addressbook_add_contacts_to_privbook:method"
          tal:condition="python:addressbook_name == '_global' and privbook_name"
          tal:attributes="value python:mcat('_Add_to_private_addressbook_')"/>
        <input type="submit"
          name="addressbook_add_contacts_links_to_privbook:method"
          tal:condition="python:addressbook_name == '_global' and privbooklinks_name"
          tal:attributes="value python:mcat('_Add_link_to_private_addressbook_')"/>
        <input type="submit"
          tal:condition="python:addressbook.isDeleteEntryAllowed()"
          tal:attributes="value python:mcat('_Delete_')"
          name="addressbook_groupdelete:method" />
      </td>
      <td align="right" nowrap>
        <input type="submit" name="mail_selected_one:method"
          tal:attributes="
            value python:mcat('_Send/Continue_a_mail_');
          " />
      </td>
    </tr>
  </table>
  <table cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
      <td bgcolor="#dcdcdc">
        <table cellpadding="2" cellspacing="1" border="0" width="100%">
          <tal:block define="
            email_prop_name wmtool/getAddressBookEmailProperty;
            title_field addressbook/title_field;
            id_field addressbook/id_field;
          ">
            <tr bgcolor="#eeeeee">
              <th align="center" valign="middle" width="1%">
                <p>
                  <b tal:content="python:mcat('_TO:_')">
                    TO:
                  </b>
                  <br>
                  <a href="javascript:SetChecked_To(1)"
                    tal:content="python:mcat('_All_')">
                    Select
                  </a>/<a href="javascript:SetChecked_To(0)"
                    tal:content="python:mcat('_None_')">
                    Unselect
                  </a>
                </p>
              </th>
              <th align="center" valign="middle" width="1%">
                <p>
                  <b tal:content="python:mcat('_CC:_')">
                    Cc:
                  </b>
                  <br>
                  <a href="javascript:SetChecked_Cc(1)"
                    tal:content="python:mcat('_All_')">
                    Select
                  </a>/<a href="javascript:SetChecked_Cc(0)"
                    tal:content="python:mcat('_None_')">
                    Unselect
                  </a>
                </p>
              </th>
              <th align="center" valign="middle" width="1%">
                <p>
                  <b tal:content="python:mcat('_BCC:_')">
                    Bcc:
                  </b>
                  <br>
                  <a href="javascript:SetChecked_Bcc(1)"
                    tal:content="python:mcat('_All_')">
                    Select
                  </a>/<a href="javascript:SetChecked_Bcc(0)"
                    tal:content="python:mcat('_None_')">
                    Unselect
                  </a>
                </p>
              </th>
              <td width="1%">&nbsp;</td>
              <th align="center" width="16%">
                <p>
                  <b>
                    <i tal:define="ltool here/portal_layouts;
                                   layoutid addressbook/layout;
                                   layoutob ltool/?layoutid;
                                   widget python:(layoutob[title_field]);
                                   disp_title widget/label;"
                       tal:content="python:mcat(disp_title)">
                      Display Prop Name
                    </i>
                  </b>
                </p>
              </th>
              <th align="center" width="16%">
                <p>
                  <b>
                    <i tal:define="ltool here/portal_layouts;
                                   layoutid addressbook/layout;
                                   layout ltool/?layoutid;
                                   disp_title layout/?email_prop_name/label"
                       tal:content="python:mcat(disp_title)">
                      Email Property name
                    </i>
                  </b>
                </p>
              </th>
              <th valign="middle" align="center" width="1%">
                <p align="center">
                  <i>
                    <strong tal:content="python:mcat('_Edit_')">
                    Edit
                    </strong>
                  </i>
                 </p>
              </th>
              <th valign="middle" align="center" width="1%"
                  tal:condition="python:addressbook_name == '_global' and privbook_name">
                <p align="center">
                  <i>
                    <strong tal:content="python:mcat('_Add_to_private_addressbook_')">
                      Add to private addressbook
                    </strong>
                  </i>
                  <br>
                  <a href="javascript:SetChecked_Add(1)"
                    tal:content="python:mcat('_All_')">
                    Select
                  </a>/<a href="javascript:SetChecked_Add(0)"
                    tal:content="python:mcat('_None_')">
                    Unselect
                  </a>
                </p>
              </th>
              <th valign="middle" align="center" width="1%"
                  tal:condition="python:addressbook_name == '_global' and privbooklinks_name">
                <p align="center">
                  <i>
                    <strong tal:content="python:mcat('_Add_link_to_private_addressbook_')">
                      Add link to private addressbook
                    </strong>
                  </i>
                  <br>
                  <a href="javascript:SetChecked_Links(1)"
                    tal:content="python:mcat('_All_')">
                    Select
                  </a>/<a href="javascript:SetChecked_Links(0)"
                    tal:content="python:mcat('_None_')">
                    Unselect
                  </a>
                </p>
              </th>
              <th valign="middle" align="center" width="1%"
                tal:condition="python:addressbook.isDeleteEntryAllowed()">
                <p>
                  <i>
                    <strong tal:content="python:mcat('_Delete_')">
                      Delete
                    </strong>
                  </i>
                  <br>
                  <a href="javascript:SetChecked_Sup(1)"
                    tal:content="python:mcat('_All_')">
                    Select
                  </a>/<a href="javascript:SetChecked_Sup(0)"
                    tal:content="python:mcat('_None_')">
                    Unselect
                  </a>
                </p>
              </th>
            </tr>
           <!-- begin repeat on search results -->
            <tal:block repeat="entryid python:request.SESSION.get('search_results', wmtool.addressBookSearch(REQUEST=request))">
                <tr bgcolor="#ffffff"
                  tal:define="entry python:wmtool.getAddressBookEntry(entryid, REQUEST=request)">
                  <tal:block define="mail_prop  entry/?email_prop_name|nothing">
                    <tal:block condition="mail_prop">
                      <td width="1%" nowrap>
                        <input type="checkbox" name="pto:list" value="2"
                          tal:attributes="value mail_prop" />
                      </td>
                      <td width="1%" nowrap>
                        <input type="checkbox" name="pcc:list" value="2"
                          tal:attributes="value mail_prop" />
                      </td>
                      <td width="1%" nowrap>
                        <input type="checkbox" name="pbcc:list" value="2"
                          tal:attributes="value mail_prop" />
                      </td>
                    </tal:block>
                    <tal:block condition="not:mail_prop">
                      <td width="1%" nowrap>&nbsp;</td>
                      <td width="1%" nowrap>&nbsp;</td>
                      <td width="1%" nowrap>&nbsp;</td>
                    </tal:block>
                  </tal:block>
                  <td width="1%" align="center">&nbsp;</td>
                  <td valign="middle" align="left" nowrap>
                    <i tal:content="python:entry.get(title_field, '')">
                      Fullname
                    </i>
                  </td>
                  <td valign="middle" align="left" nowrap>
                    <a
                      tal:define="
                        eproperty python:entry.get(email_prop_name, '');
                        condition_eprop python:eproperty != '' "
                      tal:attributes="
                        href string:${here/absolute_url}/write_addbook?to=${eproperty};">
                      <i tal:content="eproperty"
                        tal:condition="condition_eprop">
                        Email
                      </i>
                      <i
                        tal:condition="not:condition_eprop">
                        ---
                      </i>
                    </a>
                  </td>
                  <tal:block
                    define="can_edit python:addressbook.isEditEntryAllowed(entry=entry)">
                    <td width="1%" align="center" nowrap
                      tal:condition="can_edit">
                      <p>
                        <a tal:attributes="
                             href string:javascript:popup_edit_entry('addressbook_editcontact', '${addressbook_name}', '${entry/?id_field}')"
                           tal:content="python:mcat('_Edit_')">
                          Change Link
                        </a>
                      </p>
                    </td>
                    <td width="1%" align=center nowrap
                      tal:condition="not:can_edit">
                      &nbsp;
                    </td>
                  </tal:block>
                  <tal:block condition="python:addressbook_name == '_global' and privbook_name">
                    <td width="1%" align="center" nowrap>
                      <input type="checkbox" name="to_add_to_privbook:list"
                        tal:attributes="value string:${entry/?id_field}">
                    </td>
                  </tal:block>
                  <tal:block condition="python:addressbook_name == '_global' and privbooklinks_name">
                    <td width="1%" align="center" nowrap>
                      <input type="checkbox" name="to_add_to_privbooklinks:list"
                        tal:attributes="value string:${entry/?id_field}">
                    </td>
                  </tal:block>
                  <tal:block
                    define="can_delete python:addressbook.isDeleteEntryAllowed()">
                    <td width="1%" align="center" nowrap
                      tal:condition="can_delete">
                      <input type="checkbox" name="to_delete:list"
                        tal:attributes="value string:${entry/?id_field}">
                    </td>
                    <td width="1%" align="center" nowrap
                      tal:condition="not:can_delete">
                      &nbsp;
                    </td>
                  </tal:block>
                </tr>
              </tal:block>
            </tal:block>
          </table>

          <table cellpadding="3" cellspacing="0" border="0" width="100%">
            <tr bgcolor="#dcdcdc">
              <td colspan="2" nowrap>
                <input type="button"
                  tal:condition="python:addressbook.isCreateEntryAllowed()"
                  tal:attributes="value python:mcat('_New_contact_');
                                  onclick string:javascript:popup_create_entry('addressbook_addcontact', '${addressbook_name}');;"/>
                <input type="submit"
                  name="addressbook_add_contacts_to_privbook:method"
                  tal:condition="python:addressbook_name == '_global' and privbook_name"
                  tal:attributes="value python:mcat('_Add_to_private_addressbook_')"/>
                <input type="submit"
                  name="addressbook_add_contacts_links_to_privbook:method"
                  tal:condition="python:addressbook_name == '_global' and privbooklinks_name"
                  tal:attributes="value python:mcat('_Add_link_to_private_addressbook_')"/>
                <input type="submit"
                  tal:condition="python:addressbook.isDeleteEntryAllowed()"
                  name="addressbook_groupdelete:method"
                  tal:attributes="value python:mcat('_Delete_')"/>
              </td>
              <td align="right" nowrap>
                <input type="submit" name="mail_selected_one:method"
                  tal:attributes="
                    value python:mcat('_Send/Continue_a_mail_')" />
              </td>
            </tr>
          </table>
          <p>&nbsp;</p>
          <hr />

          <metal:block use-macro="here/webmail_lib/macros/back_to_message_list"/>

        </td>
      </tr>
    </table>
  </form>
</metal:block>

</html>
</tal:block>
